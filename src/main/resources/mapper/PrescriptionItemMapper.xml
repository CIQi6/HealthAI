<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.healthai.prescription.mapper.PrescriptionItemMapper">

    <resultMap id="PrescriptionItemResultMap" type="com.example.healthai.prescription.domain.PrescriptionItem">
        <id property="id" column="id" />
        <result property="prescriptionId" column="prescription_id" />
        <result property="medicineId" column="medicine_id" />
        <result property="dosageInstruction" column="dosage_instruction" />
        <result property="frequency" column="frequency" />
        <result property="daySupply" column="day_supply" />
        <result property="quantity" column="quantity" />
        <result property="contraResult" column="contra_result" javaType="com.example.healthai.prescription.domain.PrescriptionContraStatus" />
        <result property="createdAt" column="created_at" />
        <result property="updatedAt" column="updated_at" />
    </resultMap>

    <select id="findById" resultMap="PrescriptionItemResultMap">
        SELECT id, prescription_id, medicine_id, dosage_instruction, frequency,
               day_supply, quantity, contra_result, created_at, updated_at
        FROM prescription_items
        WHERE id = #{id}
    </select>

    <select id="findByPrescriptionId" resultMap="PrescriptionItemResultMap">
        SELECT id, prescription_id, medicine_id, dosage_instruction, frequency,
               day_supply, quantity, contra_result, created_at, updated_at
        FROM prescription_items
        WHERE prescription_id = #{prescriptionId}
        ORDER BY id ASC
    </select>

    <insert id="insert" parameterType="com.example.healthai.prescription.domain.PrescriptionItem" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO prescription_items (prescription_id, medicine_id, dosage_instruction, frequency,
                                        day_supply, quantity, contra_result, created_at, updated_at)
        VALUES (#{prescriptionId}, #{medicineId}, #{dosageInstruction}, #{frequency},
                #{daySupply}, #{quantity}, #{contraResult}, #{createdAt}, #{updatedAt})
    </insert>

    <update id="update" parameterType="com.example.healthai.prescription.domain.PrescriptionItem">
        UPDATE prescription_items
        SET medicine_id = #{medicineId},
            dosage_instruction = #{dosageInstruction},
            frequency = #{frequency},
            day_supply = #{daySupply},
            quantity = #{quantity},
            contra_result = #{contraResult},
            updated_at = #{updatedAt}
        WHERE id = #{id}
    </update>

    <delete id="deleteByPrescriptionId">
        DELETE FROM prescription_items WHERE prescription_id = #{prescriptionId}
    </delete>

</mapper>
